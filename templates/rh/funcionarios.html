{% extends "rh/rh.html" %}

{% block content %}
<main class="ml-64 p-8">
    <header class="flex justify-between items-center bg-red-800 text-white p-6 rounded-xl mb-8">
        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="h-10">
        <ul class="flex items-center space-x-6">
            <li>Funcionários</li>
            <li><i class="fa-solid fa-bars"></i></li>
        </ul>
    </header>

    <!-- Formulário de Cadastro -->
    <section class="bg-white p-6 rounded-xl shadow-md mb-10">
        <h2 class="text-xl font-semibold mb-4">Cadastrar Novo Funcionário</h2>
        <form id="form-cadastro" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div>
                <label for="nome" class="block mb-1 font-semibold">Nome</label>
                <input type="text" id="nome" name="nome" class="w-full p-3 border border-gray-300 rounded-md" required>
            </div>
            <div>
                <label for="dat_nasc" class="block mb-1 font-semibold">Data de Nascimento</label>
                <input type="date" id="dat_nasc" name="dat_nasc" class="w-full p-3 border border-gray-300 rounded-md" required>
            </div>
            <div>
                <label for="unidade_cadastro" class="block mb-1 font-semibold">Unidade</label>
                <select id="unidade_cadastro" name="unidade" class="w-full p-3 border border-gray-300 rounded-md" required>
                    <option value="Aldeota">Aldeota</option>
                    <option value="Parquelandia">Parquelandia</option>
                    <option value="Sul">Sul</option>
                </select>
            </div>
            <div>
                <label for="cargo_cadastro" class="block mb-1 font-semibold">Cargo</label>
                <select id="cargo_cadastro" name="cargo" class="w-full p-3 border border-gray-300 rounded-md" required>
                    <option value="Auxiliar cozinha">Auxiliar cozinha</option>
                    <option value="Supervisor">Supervisor</option>
                    <option value="Atendente">Atendente</option>
                </select>
            </div>
            <div>
                <label for="cod_int" class="block mb-1 font-semibold">Código Interno</label>
                <input type="number" id="cod_int" name="cod_int" class="w-full p-3 border border-gray-300 rounded-md" required>
            </div>
            <div class="flex items-end">
                <button type="submit" class="bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 w-full">Cadastrar</button>
            </div>
        </form>
    </section>

    <!-- Filtros -->
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div>
            <label for="unidade" class="block font-semibold mb-2 text-gray-700">Unidade</label>
            <select id="unidade" class="block w-full p-3 bg-white border border-gray-300 rounded-md">
                <option value="Todos">Todos</option>
                <option value="Aldeota">Aldeota</option>
                <option value="Parquelandia">Parquelandia</option>
                <option value="Sul">Sul</option>
            </select>
        </div>

        <div>
            <label for="cargos" class="block font-semibold mb-2 text-gray-700">Cargo</label>
            <select id="cargos" class="block w-full p-3 bg-white border border-gray-300 rounded-md">
                <option value="Todos">Todos</option>
                <option value="Auxiliar cozinha">Auxiliar cozinha</option>
                <option value="Supervisor">Supervisor</option>
                <option value="Atendente">Atendente</option>
            </select>
        </div>

        <div>
            <label for="idInput" class="block font-semibold mb-2 text-gray-700">ID</label>
            <input type="number" id="idInput" class="block w-full p-3 bg-white border border-gray-300 rounded-md" placeholder="Pesquisar por ID...">
        </div>

        <div>
            <label for="searchInput" class="block font-semibold mb-2 text-gray-700">Busca</label>
            <input type="text" id="searchInput" class="block w-full p-3 bg-white border border-gray-300 rounded-md" placeholder="Pesquisar...">
        </div>
    </section>

    <!-- Lista de Funcionários -->
    <ul id="grade-elements" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Funcionários listados aqui -->
    </ul>
</main>

<script>
    let grupo_itens = {
        '0001': { "nome": "Erick Sanderson Silva Vasconcelos", "dat_nasc": "2004-03-31", "Unidade": "Aldeota", "Cargo": "Atendente", "cod_int": 145 },
        '0002': { "nome": "Jonas Rubens Teixeira", "dat_nasc": "2000-09-24", "Unidade": "Parquelandia", "Cargo": "Atendente", "cod_int": 146 },
        '0003': { "nome": "Julio Ruan Domocrates", "dat_nasc": "2000-10-24", "Unidade": "Sul", "Cargo": "Auxiliar cozinha", "cod_int": 147 },
        '0004': { "nome": "Denys Robson Duarte", "dat_nasc": "2004-09-24", "Unidade": "Sul", "Cargo": "Supervisor", "cod_int": 148 }
    };

    function criacaoElementos(filtroUnidade, filtroCargo, filtroBusca, filtroId) {
        const blocohtml = document.getElementById("grade-elements");
        let htmlContent = "";
        const valores = Object.values(grupo_itens);

        const itemsFiltrados = valores.filter(({ Unidade, Cargo, nome, cod_int }) => {
            const filtroUnidadeValido = filtroUnidade === "Todos" || Unidade === filtroUnidade;
            const filtroCargoValido = filtroCargo === "Todos" || Cargo === filtroCargo;
            const filtroBuscaValido = filtroBusca === "" || nome.toLowerCase().includes(filtroBusca.toLowerCase());
            const filtroIdValido = filtroId === "" || cod_int.toString() === filtroId.toString();

            return filtroUnidadeValido && filtroCargoValido && filtroBuscaValido && filtroIdValido;
        });

        itemsFiltrados.forEach(({ nome, dat_nasc, Unidade, Cargo, cod_int }) => {
            htmlContent += `
                <li class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-all">
                    <img src="{{ url_for('static', filename='img/internals/') }}${cod_int}.png" alt="${nome}" class="w-16 h-16 rounded-full mx-auto mb-4">
                    <div class="text-center">
                        <p><strong>Func:</strong> ${nome}</p>
                        <p><strong>Data Nasc:</strong> ${dat_nasc}</p>
                        <p><strong>Cargo:</strong> ${Cargo}</p>
                        <p><strong>Código:</strong> ${cod_int}</p>
                    </div>
                </li>
            `;
        });

        blocohtml.innerHTML = htmlContent;
    }

    $(document).ready(function () {
        $("#unidade, #cargos").select2({ placeholder: "Selecione uma opção", allowClear: true });

        $("#unidade, #cargos").on('change', function () {
            criacaoElementos($("#unidade").val(), $("#cargos").val(), $("#searchInput").val(), $("#idInput").val());
        });

        $("#searchInput, #idInput").on('input', function () {
            criacaoElementos($("#unidade").val(), $("#cargos").val(), $("#searchInput").val(), $("#idInput").val());
        });

        // Cadastra novo funcionário
        $("#form-cadastro").on('submit', function (e) {
            e.preventDefault();

            const nome = $("#nome").val();
            const dat_nasc = $("#dat_nasc").val();
            const Unidade = $("#unidade_cadastro").val();
            const Cargo = $("#cargo_cadastro").val();
            const cod_int = $("#cod_int").val();

            if (!grupo_itens[cod_int]) {
                grupo_itens[cod_int] = { nome, dat_nasc, Unidade, Cargo, cod_int: parseInt(cod_int) };
                criacaoElementos($("#unidade").val(), $("#cargos").val(), $("#searchInput").val(), $("#idInput").val());
                this.reset();
            } else {
                alert("Já existe um funcionário com esse código.");
            }
        });
    });

    document.addEventListener("DOMContentLoaded", () => criacaoElementos("Todos", "Todos", "", ""));
</script>
{% endblock %}
